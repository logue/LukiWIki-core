# LukiWiki記法草案

LukiWiki記法はMarkdownとPukiWikiを足して２で割った記法と考えていいです。
変換プログラムのコードは[こちら](https://github.com/logue/LukiWiki/blob/master/app/LukiWiki/Utility/Converter.php)

## 見出し

Markdown準拠。PukiWikiでは3レベルまででしたが、LukiWikiでは5レベルまで使用できます。

```
# 見出し１
## 見出し２
### 見出し３
#### 見出し４
##### 見出し５
```

## リスト項目

レベルの表記の仕方がMarkdown風。ただし識別子の文字はPukiWiki風。
Markdownでは、リスト項目内にブロック型要素（テーブルやコードなど）を含めることはできませんが、LukiWikiではPukiWikiと同様に含めることができます。

例えば以下のような表記はMarkdownでは許容されませんが、LukiWikiでは許容されます。

```
- 項目１
\`\`\`
定義文
\`\`\`
 - 項目２
|~foo   |~bar   |
|baz    |quz    |
```

### 番号なし

```
- 項目レベル１
 - 項目レベル２
  - 項目レベル３
```

### 番号付き

```
+ 項目レベル１
 + 項目レベル２
  + 項目レベル３
```

### チェックボックス

これらはreadonlyです。

```
[ ] チェックなしレベル１
 [x] チェックありレベル２
  [-] チェック中間状態レベル３
```

### ラジオボタン

必要あるのか？

```
( ) チェックなしレベル１
 (x) チェックありレベル２
```

### 定義文

ここはPukiWikiと同じです。Markdownには仕様がありません。

```
:定義|説明文
```

## 整形済みテキスト

GithubのMarkdown準拠。

PukiWikiの行の先頭にスペースやタブを先頭に入れる記法はサポートしません。
変換プログラムではcodeプラグインや自分のshプラグインを含めて自動的に以下の書式に変換されます。
シンタックスハイライトは、CodeMirrorを使用。
オプションには、ハイライトさせたい言語を入れる。

~~~
```[言語]:[ファイル名]
整形済みテキスト文
```
~~~

ここの仕様は確定していません。ひょっとすると後述するブロック型プラグインと統合することもあります。

## テーブル

Markdownではテーブルのセルの連結や背景色などが指定できないため、PukiWik準拠となります。
末尾の|を省略することはできません。

```
|見出し     |見出し                 |見出し |h
|セル       |セル                   |セル   |
|RIGHT:右   |COLOR(--blue):青文字   |       |
```

Plus!の,区切りのテーブル書式は使えません。

## ブロック型引用符

PukiWiki準拠

```
>
引用文
<
```

## 水平線

PukiWiki準拠

-を4つ以上

```
----
```

ここの仕様は変更になる場合があります。

## リンク／InterWiki

Markdown形式となります。

```
[InterWiki]
[リンク名](アドレス or InterWiki)
<アドレス>
[リンク名](アドレス or InterWiki "ツールチップ"){idやclassなど}
```

## 文字装飾

PukiWiki準拠の書き方とMarkdown準拠の書き方がの両方をサポートします。

Markdown記法で書くとstrongやemなどの意味合いの持つタグでくくられ、PukiWiki記法で書くとbやiのような単純な装飾のみのタグでくくられる仕様です。
表示上は変わりありませんが、意味合いは異なります。

### 強調（strongタグ）

```
* 文字列 *
```

### 太文字（bタグ）

```
''文字列''
```

### より強い強調（emタグ）

```
** 文字列 **
```

### 斜体（iタグ）

```
'''文字列'''
```

### 下線（uタグ）

```
___文字列___
```

### 字消し線（strikeタグ）

```
%%文字列%%
```

### コード（codeタグ）

Markdown準拠です。\`は、Shift+@で入力します。

```
`コード文`
```

## 文字色、背景色、フォントサイズ、上付き、下付き、

* Markdownには仕様がないためPukiWiki準拠となります。
* --から始まる色は、CSSで定められる定数をいれます。
デフォルトでは、[bootstrapのテーマカラー](https://getbootstrap.com/docs/4.2/getting-started/theming/#all-colors)が使用可能です。（`COLOR(--blue)`など。）
* サイズの単位はremとなりPukiWikiのpx指定ではないため注意。（変換プログラムでは自動的にrem数値に変換されます）

```
COLOR(--blue)
BGCOLOR(--gray)
SIZE(1)
SUP(上付き)
SUB(下付き)
LANG(言語){対象文字}
ABBR(文字列){文字列の説明}
```

### 絵文字

Adv.では`&(絵文字名);`でしたが、LukiWikiでは`::絵文字名::`になる予定です。

## 画像、動画、オーディオ

PukiWikiではrefプラグインによる実装でしたがMarkdown準拠となり本体の機能として表現します。通常のリンクとの違いは、!マークから始まるというところです。

```
![Alt text](メディアファイル "タイトルテキスト"){id class}
```

添付ファイルは、新形式のrefプラグイン表記の指定と同じで、ページ名/ファイル名になります。
ページ名を省略した場合、そのページに添付されているファイルが対象になります。

このため、ページ名に.を含めることはできません。

画像にリンクを貼る場合以下のような表記になります。

```
[![](メディアファイル)](リンク先)]
```

## プラグイン

最初のリリースのバージョンでサポートする予定はありません。
あくまでも仕様として記載しておきます。

オプションは、カンマ区切りで指定します。

### ブロック型

識別子の#が見出しで使われるため、\#から@に変更になっています。
入力は複数行対応のブロック型プラグインと同じです。

```
@プラグイン名(オプション,オプション2...){{
変換対象
}}
```

例えばumlというプラグインがあり、{{ }}でくくられた部分をplantumlでUML画像に変換するという機能のプラグインがあった場合以下のようになります。

```
@plantuml{{
Bob -> Alice: Hello!
}}
```

### インライン型

PukiWikiと全く同じです。

```
&プラグイン名(オプション){変換対象}
```

### API型

PukiWikiにおけるアクション型は現段階では脆弱性の原因になるためサポートしていません。ただし、ajax埋め込み用にアドレスの末尾に`:プラグイン名`を加えることでjsonを出力することはできます。