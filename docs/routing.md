# LukiWikiルーティング仕様

PukiWikiと同じように/を用いた階層構造をもたせたページを作ることができます。原則的にパス部分がページ名になります。
重要なのは、SSR（サーバーで描画する）部分はリーダーで、SPA（クライアントサイドで描画する）部分はエディタであるという考え方です。

ただし、`:`と`.`を含めるページ名は特殊な用途で使用するためページ名に含めることはできません。これらの文字が含まれた場合以下のように処理します。

## SPA部分ではハッシュを用いたルーティングは使用しません

ページ内のアンカーリンクで使用するため、`#`を用いたルーティングは行いません。

## `:`はSPA部分で使用します。

編集する場合、`https://.../MainPage:edit`のようなルーティングになります。
このアドレスの内、phpで作用するのはMainPageまでで、残りの`:`から始まる部分はクライアントサイド側で処理するルーティングとなります。
`location.path.split(':')[1]`はSPA側でパラメータとして使用します。
パラメータの考えからして、`https://.../MainPage:history/1`の場合、MainPageの１世代目のバックアップを表示するという意味になります。

## `.`は添付ファイルとページ名かの判定で使用します。

例えば、`https://.../MainPage/image.png`の場合、`MainPage`に貼り付けられた`image.png`という意味になります。
もちろん、`https://.../MainPage/image.ja.png`の場合も`MainPage`に貼り付けられた`image.ja.png`という意味になります。
（PukiWikiにおける新形式のrefプラグインの添付ファイルの貼り付け方の仕様準拠）

このため、拡張子を含まないファイルをアップすることはできません。mimeをチェックし、判別できない場合は.binが付加されます。

ただし、添付ファイルは内部的にSHA1ハッシュで実体名を管理しているため、ファイルのハッシュ値が同じであった場合、複数のページから同一のファイルを参照しているということもあり得ます。
言い換えると、外部からは個別のページにファイルがあるように見えますが、ハッシュが同じだった場合同一の実体を参照するということになります。

この処理はサーバー側で行います。
